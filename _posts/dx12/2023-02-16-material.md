---
#layout: posts
excerpt: ""
title: "[DirectX12] ğŸ“‚. Material"
categories:
    - dx12
# tag:
# Â  Â  [cpp, c++, oop]
toc_label: "ëª©ì°¨"
toc: true
toc_sticky: true
date: 2023-02-16
last_modified_at: 2023-02-16

#published: false
---

# ğŸ”· Material
- ë¬¼ì²´ë¥¼ êµ¬ì„±í•˜ëŠ” ë¬¼ì§ˆ ë˜ëŠ” ë¬¼ì§ˆì˜ í˜¼í•©ë¬¼  

## 1. Material Class
- Shader, Texture ê·¸ë¦¬ê³  ê·¸ ì™¸ì˜ ìƒìˆ˜ê°’(Material Params)ë¥¼ ë¬¶ì–´ì„œ ê´€ë¦¬í•´ì£¼ëŠ” í´ë˜ìŠ¤  
- ê¸°ì¡´ì— í•˜ë‚˜ì”© ë„˜ê²¨ì£¼ë˜ ê°’ë“¤ì„ Materialì´ë¼ëŠ” í´ë˜ìŠ¤ë¡œ ë¬¶ì–´ì„œ ê´€ë¦¬  

> Material Params
> - CBVë¡œ ìƒì„±ë˜ë©° intê°’ 5ê°œ, floatê°’ 5ê°œ, texturerê°’ 5ê°œë¡œ ìƒì„±í•œë‹¤.  
> - MaterialParamsë¼ëŠ” êµ¬ì¡°ì²´(struct)ë¥¼ ì´ìš©í•˜ì—¬ intì™€ floatê°’ì„ ê´€ë¦¬í•œë‹¤.  

```cpp
cbuffer MATERIAL_PARAMS : register(b1)
{
    int int_0;
    int int_1;
    int int_2;
    int int_3;
    int int_4;
    float float_0;
    float float_1;
    float float_2;
    float float_3;
    float float_4;
}

Texture2D tex_0 : register(t0);
Texture2D tex_1 : register(t1);
Texture2D tex_2 : register(t2);
Texture2D tex_3 : register(t3);
Texture2D tex_4 : register(t4);
```

```cpp
enum
{
	MATERIAL_INT_COUNT = 5,
	MATERIAL_FLOAT_COUNT = 5,
	MATERIAL_TEXTURE_COUNT = 5,
};

// b1 registerë¡œ í•œêº¼ë²ˆì— ë„˜ê¸°ê¸° ìœ„í•´ TextureëŠ” í•¨ê»˜ ë¬¶ì§€ ì•ŠëŠ”ë‹¤.
struct MaterialConstantParams
{
	void SetIntParam(uint8 index, int32 value) { intParams[index] = value; }
	void SetFloatParam(uint8 index, float value) { floatParams[index] = value; }

	array<int32, MATERIAL_INT_COUNT> intParams = { 0, 0, 0, 0, 0 };
	array<float, MATERIAL_FLOAT_COUNT> floatParams = { 0.f, 0.f, 0.f, 0.f, 0.f };
};

class Material
{
    ...

private:
	shared_ptr<Shader>									_shader;
	MaterialConstantParams								_params;
	array<shared_ptr<Texture>, MATERIAL_TEXTURE_COUNT>	_textures = {};
};
```

```cpp
// CBV
MyEngine->GetConstantBuffer(CONSTANT_BUFFER_TYPE::MATERIAL)->PushData(&_params, sizeof(_params));

// SRV
for (size_t i = 0; i < _textures.size(); i++)
{
    if (_textures[i] == nullptr)
        continue;

    SRV_REGISTER reg = SRV_REGISTER(static_cast<int8>(SRV_REGISTER::t0) + i);
    MyEngine->GetTableDescriptorHeap()->SetShaderResourceView(_textures[i]->GetCpuHandle(), reg);
}

// Shader
_shader->Update();
```

<br>

## 2. Constant Buffer ë‚˜ëˆ„ê¸°
- Materialë¡œ ì¸í•´ ìš©ë„ë³„ë¡œ ConstantBufferë¥¼ ë¶„ë¦¬  
- Engineì—ì„œ ConstantBufferê°’ì„ ê°€ì ¸ì˜¬ ë•Œ, Typeìœ¼ë¡œ ì„ ë³„í•˜ì—¬ ê°€ì ¸ì˜¨ë‹¤.

```cpp
enum class CONSTANT_BUFFER_TYPE : uint8
{
	TRANSFORM,  // b0
	MATERIAL,   // b1

	END // CONSTANT_BUFFER_COUNT
};

array<shared_ptr<ConstantBuffer>, CONSTANT_BUFFER_COUNT>    _constantBuffers;
shared_ptr<ConstantBuffer> GetConstantBuffer(CONSTANT_BUFFER_TYPE type) 
{ 
    return _constantBuffers[static_cast<uint8>(type)]; 
}
```

<br>

## 3. Meshì— Materialë¡œ ì •ë¦¬í•˜ê¸°

```cpp
class Mesh
{
    ...

private:
	Transform					_transform = {};
	shared_ptr<Material>		_material;
};
```

<br>

## ğŸ”¹ ê²°ê³¼  
- ë¬¼ì²´ì˜ posì˜ x, y, zê°’ì— float_0, float_1, float_2 ê°’ì„ ì ìš©ì‹œì¼œ í…ŒìŠ¤íŠ¸ í•˜ì˜€ì„ ë•Œ, ê°’ì´ ì ìš©ëœ ê²°ê³¼ê°’ì´ ë‚˜ì™”ë‹¤.
![image](../../assets/images/dx12_img/10_material/result.png)  
<br>

# ğŸ“‘. ì°¸ê³ 
* [Rookiss. [C++ê³¼ ì–¸ë¦¬ì–¼ë¡œ ë§Œë“œëŠ” MMORPG ê²Œì„ ê°œë°œ ì‹œë¦¬ì¦ˆ]Part2: ê²Œì„ ìˆ˜í•™ê³¼ DirectX12. Inflearn.](https://www.inflearn.com/course/%EC%96%B8%EB%A6%AC%EC%96%BC-3d-mmorpg-2/dashboard)
* [í”„ë­í¬ D. ë£¨ë‚˜(2020). DirectX 12ë¥¼ ì´ìš©í•œ 3Dê²Œì„ í”„ë¡œê·¸ë˜ë° ì…ë¬¸. í•œë¹›ë¯¸ë””ì–´(ì£¼).](https://www.hanbit.co.kr/store/books/look.php?p_code=B5088646371)